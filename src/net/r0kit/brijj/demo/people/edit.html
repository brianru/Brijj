<!DOCTYPE html>
<html>
<head>
  <title>Editable Table Demo</title>
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
  <script type='text/javascript' src='../tabs/tabs.js'> </script>
  <script type='text/javascript' src='../brijj/engine.js'> </script>
  <script type='text/javascript' src='../brijj/interface/People.js'> </script>
  <script type="text/javascript" src='edit.js'> </script>
  <link rel="stylesheet" type="text/css" href="../tabs/tabs.css" />
  <link rel="stylesheet" type="text/css" href="../generic.css" />
</head>
<body onload="init();">
<div id="page-title">[
  <a href="http://r0kit.net/brijj/">brijj Website</a> |
  <a href="..">Web Application Index</a>
]</div>

<h1>Dynamically Editing a Table</h1>

<p>This demo allows you to edit a table of data</p>

<ul id="tabList">
  <li><a data-tab="demoDiv">Demo</a></li>
  <li><a data-tab="explainDiv">How it works</a></li>
</ul>


  <div id="demoDiv">

    <h3>All People</h3>
    <table border="1" class="rowed grey">
      <thead>
        <tr>
          <th>Person</th>
          <th>Age</th>
          <th>Superhero?</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="peoplebody">
        <tr id="pattern" style="display:none;">
          <td>
            <span id="tableName">Name</span><br/>
            <small>&nbsp;&nbsp;<span id="tableAddress">Address</span></small>
          </td>
          <td><span id="tableAge">Age</span></td>
          <td><span id="tableSuperhero">Superhero</span></td>
          <td>
            <input id="edit" type="button" value="Edit" onclick="editClicked(this.id)"/>
            <input id="delete" type="button" value="Delete" onclick="deleteClicked(this.id)"/>
          </td>
        </tr>
      </tbody>
    </table>
    <h3>Edit Person</h3>
    <table class="plain">
      <tr>
        <td>Name:</td>
        <td><input id="name" type="text" size="30"/></td>
      </tr>
      <tr>
        <td>Address:</td>
        <td><input id="address" type="text" size="40"/></td>
      </tr>
      <tr>
        <td>Age:</td>
        <td><input id="age" type="text" size="20"/></td>
      </tr>
      <tr>
        <td>Superhero?:</td>
        <td><input id="superhero" type="checkbox" size="20"/></td>
      </tr>
      <tr>
        <td colspan="2" align="right">
          <small>(ID=<span id="id">-1</span>)</small>
          <input type="button" value="Save" onclick="writePerson()"/>
          <input type="button" value="Clear" onclick="clearPerson()"/>
       </td>
      </tr>
    </table>

  </div>

  <div id="explainDiv">
    <h2>Creating the table</h2>
    <p>When the page first loads, the onload event calls the server-side
    <code>People.getSmallCrowd()</code> function to return an array of people
    objects.</p>
    <p>A Person is just a POJO containing an id, name and address fields along
    an age as an integer an boolean superhero status. Full details of the Java
    source are shown on the "Source" tab.</p>
    <p>The Javascript uses the <code>cloneNode()</code> feature to create a row
    in a table for each returned person. So for each person we do this:</p>


    <p>This creates a copy of the node with the id "pattern", and alters the ids
    of any sub-nodes to have a suffix of the current persons id, so if pattern
    looks like this:</p>

<pre>&lt;div id="pattern"&gt;&lt;input id="edit"/&gt;&lt;/div&gt;</pre>

    <p>Then after cloning using an idSuffix:42, you will have this:</p>

<pre>&lt;div id="pattern"&gt;&lt;input id="edit"/&gt;&lt;/div&gt;
&lt;div id="pattern42"&gt;&lt;input id="edit42"/&gt;&lt;/div&gt;</pre>

    <p>After cloning we then fill in the blanks in the newly cloned row. This
    uses the <code>setValue</code> that we looked at in the Dynamic Text demo:</p>


    <p>We also need to ensure that the pattern row is not visible, but the
    clones are. We do this by setting a style of display:none on the pattern
    row in the HTML, and then setting the cloned row to have display:table-row
    in the Javascript:</p>

    <p>For the full Javascript or the HTML, see the source tab. The full
    Javascript does 2 extra things - it caches the people, and sorts them.</p>

    <h2>Populating the form</h2>
    <p>When an 'edit' button is clicked, the <code>editClicked()</code> function
    is called with the id of the button. We can work out the person id from this
    easily because the button was created by the clone process, so the person id
    is just the button id without the 'edit' prefix.</p>
    <p>This makes the <code>editClicked()</code> function really simple:</p>


    <h2>Updating the server</h2>
 
<pre>
function writePerson() {

  brijj.engine.beginBatch();
  People.setPerson(person);
  fillTable();
  brijj.engine.endBatch();
}
</pre>

  </div>

</body>
</html>
