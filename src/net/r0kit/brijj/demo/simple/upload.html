<!DOCTYPE html>
<html>
<head>
  <title>File Upload Demo</title>
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
  <script type='text/javascript' src='../tabs/tabs.js'> </script>
  <script type='text/javascript' src='../brijj/engine.js'> </script>
  <script type='text/javascript' src='../brijj/interface/UploadDownload.js'> </script>
  <script type="text/javascript" src='upload.js'> </script>
  <link rel="stylesheet" type="text/css" href="../tabs/tabs.css" />
  <link rel="stylesheet" type="text/css" href="../generic.css" />
</head>
<body onload="Tabs('tabList');">
<div id="page-title">[
  <a href="http://r0kit.net/brijj/">BRIJJ Website</a> |
  <a href="..">Web Application Index</a>
]</div>

<h1>Asynchronous FileUpload</h1>

<p>This is an example of uploading files via DWR</p>

<ul id="tabList">
  <li><a data-tab="demoDiv">Demo</a></li>
  <li><a data-tab="explainDiv">How it works</a></li>
</ul>

  <div id="demoDiv">

    <p>Please select an image and a text file for uploading. A simple transform
    will take the image a scale it to 200 pixels square, and emboss on it the
    text from the uploaded file.</p>

  	<table class="plain grey form">
      <tr>
        <th>Image:</th>
        <td><input type="file" id="uploadImage" size="30"/></td>
      </tr>
      <tr>
        <th>File:</th>
        <td><input type="file" id="uploadFile" size="30"/></td>
      </tr>
      <tr>
        <th>Color:</th>
        <td>#<input type="text" id="color" value="FFFFFF" size="7"/></td>
      </tr>
      <tr>
        <th></th>
      	<td>
          <button onclick="uploadFiles()">Upload</button>
      	</td>
      </tr>
  	</table>

    <br/>    
    <img id="image" src="javascript:void(0);"/>

  </div>

  <div id="explainDiv">
<p>DWR automatically converts files from the browser to instances of
<code>FileUpload</code> using the &quot;file&quot;
converter. When you click on the Upload button the browser calls the
<code>uploadFiles()</code> function, which simply gets the values from the
3 input elements and passes them up to DWR:</p>

<p>On the server, DWR calls the <code>FileUploader.uploadFiles()</code> Java
method, which has the following signature:</p>

<pre>
BufferedImage uploadFiles(BufferedImage uploadImage, String uploadFile, String color)
</pre>

<p>Transform the image by scaling it and writing the text onto the image</p>

<pre>
uploadImage = scaleToSize(uploadImage);
uploadImage = grafitiTextOnImage(uploadImage, uploadFile, color);
return uploadImage;
</pre>

<p>And that's basically it. See the full source for how to resize using an
AffineTransform and write text onto an image, it's got nothing to do with DWR,
so we can skip it for now. The Java code returns the image which DWR converts
and passes it to the callback in the JavaScript which simply updates the image
in the web page:</p>

<p>The <b>really</b> good news is that 99% of this code is about image
manipulation. The DWR part is trivially easy.</p>

  </div>

</body>
</html>
  
